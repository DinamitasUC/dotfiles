(()=>{const e=new class{constructor(){this.config={},this.queue=[],this.uid="",this.version=chrome.runtime.getManifest().version,this.initListeners()}initListeners(){chrome.action.onClicked.addListener(this.inject),chrome.runtime.onMessage.addListener((function(t,r,a){return"take_screen_shot"===t.method?e.screenShot(a):"save_data"===t.method?e.saveData(t.config):"get_data"===t.method?e.getData(a):"open_options"===t.method&&chrome.runtime.openOptionsPage(),!0}))}saveData(e){try{chrome.storage.local.set({config:JSON.stringify(e)})}catch(e){}}getData(e){chrome.storage.local.get("config",(t=>{const r=t.config??"{}";var a=null;try{a=JSON.parse(r)}catch(e){}e(a)}))}inject(e){chrome.scripting.insertCSS({target:{tabId:e.id},files:["/css/basic.min.css"]},(function(){if(chrome.extension.lastError){chrome.extension.lastError.message;try{alert("We are sorry, but the page you are viewing is not supported. Please try another page.")}catch(e){}}chrome.scripting.executeScript({target:{tabId:e.id},files:["/popup.js"]})}))}screenShot(t){chrome.tabs.captureVisibleTab((r=>{var a=chrome.runtime.getURL("editor.html");chrome.tabs.query({},(function(s){var n;if(s&&s.length)for(var o=s.length-1;0<=o;o--)if(s[o].url===a){n=s[o];break}n?chrome.tabs.update(n.id,{active:!0},Function.prototype.bind.call(e.updateScreenshot,e,r,t,0)):chrome.tabs.create({url:a},Function.prototype.bind.call(e.updateScreenshot,e,r,t,0))}))}))}updateScreenshot(t,r){var a=arguments[2];null==a&&(a=0),10<a||chrome.runtime.sendMessage({method:"update_url",url:t},(async function(s){s&&s.success||await chrome.alarms.create("updateScreenshot",{delayInMinutes:1/60/3}),chrome.alarms.onAlarm.addListener((s=>{"updateScreenshot"===s.name&&(e.updateScreenshot(t,r,++a),chrome.alarms.clear("updateScreenshot"))}))}))}}})();